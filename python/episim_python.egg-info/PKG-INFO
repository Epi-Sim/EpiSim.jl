Metadata-Version: 2.4
Name: episim-python
Version: 0.1.0
Summary: Python interface for EpiSim.jl epidemic simulation package
Author-email: EpiSim Development Team <miguel.ponce@bsc.es>
License: MIT
Project-URL: Homepage, https://github.com/Epi-Sim/EpiSim.jl
Project-URL: Repository, https://github.com/Epi-Sim/EpiSim.jl
Project-URL: Issues, https://github.com/Epi-Sim/EpiSim.jl/issues
Project-URL: Documentation, https://github.com/Epi-Sim/EpiSim.jl/blob/main/README.md
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: Topic :: Scientific/Engineering :: Medical Science Apps.
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.19.0
Requires-Dist: pandas>=1.2.0
Requires-Dist: xarray>=0.16.0
Requires-Dist: netcdf4>=1.5.0
Requires-Dist: jsonschema>=3.2.0
Requires-Dist: pytest>=8.3.5
Requires-Dist: ruff>=0.12.3
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.0; extra == "dev"

# EpiSim Python Interface

A Python wrapper for the EpiSim.jl epidemic simulation package that provides high-level interfaces for configuration management, input file manipulation, and step-by-step simulation execution.

## Features

- **Step-by-step simulation**: Execute simulations in discrete time steps with dynamic parameter updates
- **Configuration management**: Comprehensive configuration validation and manipulation
- **Input file handling**: Support for NetCDF, CSV, and JSON input formats
- **Metapopulation support**: Handle complex metapopulation structures with aggregation
- **Multiple engines**: Support for both MMCACovid19 and MMCACovid19Vac engines

## Installation

### Prerequisites

1. **Julia**: Install Julia (>= 1.6) from [julialang.org](https://julialang.org/)
2. **EpiSim.jl**: Install and compile the EpiSim.jl package (see parent directory)

### Install Python Package

```bash
# From the python directory
pip install -e .

# Or install from requirements
pip install -r requirements.txt
```

## Julia Engine Integration

This Python package acts as a wrapper around the Julia-based EpiSim.jl engine, providing two execution modes:

### Compiled Mode (Recommended for Production)
The `install.jl` script can create a standalone compiled executable (`episim`) that bundles all Julia dependencies into a single binary. This mode offers:
- **Fast startup**: No Julia compilation overhead
- **Standalone execution**: No Julia runtime dependencies
- **Better performance**: Optimized for production use

```python
# Uses the compiled executable at ../episim
model.setup(executable_type='compiled')
```

### Interpreter Mode (Recommended for Development)
Uses the Julia interpreter to run the EpiSim.jl source code directly. This mode provides:
- **Faster development**: No recompilation needed for code changes
- **Easier debugging**: Direct access to Julia code and error messages
- **Flexibility**: Can modify Julia code without rebuilding

```python
# Uses Julia interpreter with src/run.jl
model.setup(executable_type='interpreter')
```

### How it Works

The Python wrapper communicates with the Julia engine through:
1. **JSON configuration files**: Parameters are written to temporary JSON files
2. **NetCDF state files**: Model state is persisted between simulation steps
3. **Command-line interface**: Subprocess calls to the Julia executable/interpreter
4. **File-based I/O**: Results are read from output NetCDF files

This design allows leveraging Julia's high-performance computation while maintaining Python's ease of use, though it requires file I/O for each simulation step.

## Quick Start

```python
import json
from episim_python import EpiSim, EpiSimConfig

# Load configuration
with open("../models/mitma/config_MMCACovid19.json", 'r') as f:
    config = json.load(f)

# Initialize model
model = EpiSim(
    config=config,
    data_folder="../models/mitma",
    instance_folder="../runs",
    initial_conditions="../models/mitma/initial_conditions.nc"
)

# Setup execution (compiled or interpreter)
model.setup(executable_type='interpreter')

# Run step-by-step simulation
current_date = "2020-02-09"
for i in range(10):
    new_state, next_date = model.step(current_date, length_days=7)
    
    # Update parameters dynamically
    config["NPI"]["κ₀s"] = [config["NPI"]["κ₀s"][0] * 0.95]
    model.update_config(config)
    
    current_date = next_date
```

## Main Classes

### EpiSim
Main wrapper class for step-by-step simulation execution.

### EpiSimConfig
Configuration management with validation and group parameter handling.

### Metapopulation
Handles metapopulation data with aggregation capabilities.

## Configuration Management

```python
from episim_python import EpiSimConfig

# Load and validate configuration
config = EpiSimConfig.from_json("config.json")
config.validate()

# Update parameters
config.update_param("epidemic_params.βᴵ", 0.1)
config.update_group_param("epidemic_params.γᵍ", "Y", 0.005)

# Batch updates
config.inject({
    "epidemic_params.βᴵ": 0.1,
    "NPI.κ₀s": [0.8]
})
```

## Input File Formats

### Configuration (JSON)
Standard EpiSim.jl configuration format with sections for simulation, data, epidemic parameters, population parameters, and NPI.

### Initial Conditions (NetCDF)
Multi-dimensional arrays representing compartment populations by age group, metapopulation, and vaccination status.

### Metapopulation Data (CSV)
Population data by region and age group with area information.

### Mobility Matrix (CSV)
Connectivity matrix between metapopulations.

## Examples

See the `examples/` directory for:
- Basic simulation setup
- Parameter sensitivity analysis
- Step-by-step execution with policy updates
- Configuration validation and manipulation

## Dependencies

- numpy (>= 1.19.0)
- pandas (>= 1.2.0)
- xarray (>= 0.16.0)
- netcdf4 (>= 1.5.0)

## License

MIT License - see parent directory for details.
